import yaml
import os
from ClientRepository import ClientRepository
from ClientBase import Client

class Client_rep_yaml(ClientRepository):
    # a
    def read_all(self):
        if not os.path.exists(self.path):
            return []
        with open(self.path, "r", encoding="utf-8") as f:
            try:
                data = yaml.safe_load(f) or []
                if isinstance(data, dict):
                    data = [data]
                return [Client(d, from_dict=True) for d in data]
            except yaml.YAMLError:
                return []

    # b
    def write_all(self):
        data = [
            {
                "id": c.id,
                "surname": c.surname,
                "name": c.name,
                "patronymic": c.patronymic,
                "phone": c.phone,
                "passport": c.passport,
                "email": c.email,
                "comment": c.comment
            }
            for c in self.clients
        ]
        with open(self.path, "w", encoding="utf-8") as f:
            yaml.safe_dump(data, f, allow_unicode=True, sort_keys=False)
